<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Decoding Sidewinder APT Malware" /><meta name="author" content="megachar0x01" /><meta property="og:locale" content="en" /><meta name="description" content="First Stage: The initial phase involves a malicious document programmed to download an RTF file from the following URL: “hxxps://dgmp-paknavy.mod-pk[.]com/14325/1/10/2/0/0/0/m/files-5291bef6/file[.]rtf”." /><meta property="og:description" content="First Stage: The initial phase involves a malicious document programmed to download an RTF file from the following URL: “hxxps://dgmp-paknavy.mod-pk[.]com/14325/1/10/2/0/0/0/m/files-5291bef6/file[.]rtf”." /><link rel="canonical" href="https://megachar0x01.github.io/posts/eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7/" /><meta property="og:url" content="https://megachar0x01.github.io/posts/eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7/" /><meta property="og:site_name" content="Megachar0x01" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-02T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Decoding Sidewinder APT Malware" /><meta name="twitter:site" content="@megachar0x01" /><meta name="twitter:creator" content="@megachar0x01" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"megachar0x01"},"dateModified":"2023-08-02T22:16:32+08:00","datePublished":"2023-08-02T00:00:00+08:00","description":"First Stage: The initial phase involves a malicious document programmed to download an RTF file from the following URL: “hxxps://dgmp-paknavy.mod-pk[.]com/14325/1/10/2/0/0/0/m/files-5291bef6/file[.]rtf”.","headline":"Decoding Sidewinder APT Malware","mainEntityOfPage":{"@type":"WebPage","@id":"https://megachar0x01.github.io/posts/eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7/"},"url":"https://megachar0x01.github.io/posts/eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7/"}</script><title>Decoding Sidewinder APT Malware | Megachar0x01</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Megachar0x01"><meta name="application-name" content="Megachar0x01"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/tmp/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Megachar0x01</a></div><div class="site-subtitle font-italic">A Cyber Security Enthusiast | CTF Player | Malware Analyst | Aspiring for pwnmaster</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Megachar0x01" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/megachar0x01" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['abdullahshahbaz','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Decoding Sidewinder APT Malware</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Decoding Sidewinder APT Malware</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1690905600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 2, 2023 </em> </span> <span> Updated <em class="" data-ts="1690985792" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 2, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Abdullah Shahbaz </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="601 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><p><strong>First Stage:</strong> The initial phase involves a malicious document programmed to download an RTF file from the following URL: “hxxps://dgmp-paknavy.mod-pk[.]com/14325/1/10/2/0/0/0/m/files-5291bef6/file[.]rtf”.</p><p><img data-src="https://i.imgur.com/Yq0fwVc.png" alt="img_1" data-proofer-ignore></p><p><strong>Second Stage:</strong> The downloaded file, file.rtf, contains CVE-2017-0199, a vulnerability in Microsoft Word that enables attackers to execute a malicious Visual Basic script. This flaw grants them the ability to execute embedded JavaScript within RTF stream 0.</p><p><img data-src="https://i.imgur.com/wD7iGKU.png" alt="img_2" data-proofer-ignore></p><p>extracting stream 0 from rtf</p><p><img data-src="https://i.imgur.com/Y5tNZos.png" alt="img_2" data-proofer-ignore></p><p>Extracted JavaScript in its obfuscated state.</p><p><img data-src="https://i.imgur.com/izUZk5m.png" alt="img_2" data-proofer-ignore></p><p>After the code has been cleaned, it appears something like this.</p><p><img data-src="https://i.imgur.com/eekl6xS.png" alt="img_2" data-proofer-ignore></p><p>This function primarily checks for an available .NET compiler and then generates a path to ‘csc.exe’ for on-the-fly compilation of C# code to evade detection. However, it was not utilized in this sample, leading us to hypothesize that the code may be reused or could be employed in an upcoming campaign.</p><p><img data-src="https://i.imgur.com/2tG7LwJ.png" alt="img_2" data-proofer-ignore></p><p>In this sample, the code begins by checking for the installed antivirus software using “wingmts.” Simultaneously, it decodes base64 content, extracting a DLL (confirmed after analyzing the PE file) from it. Subsequently, the extracted DLL is loaded into the process. The code then appends the antivirus name to a URL before invoking “Program.work” from the loaded DLL library, passing the combined URL and antivirus name as parameters to the function.</p><p><img data-src="https://i.imgur.com/BAVpnx8.png" alt="img_2" data-proofer-ignore></p><p>Decrypting Base64</p><p><img data-src="https://i.imgur.com/QXbZiWX.png" alt="img_2" data-proofer-ignore></p><p>Ectracting dll from base64 . Upon opening the file in PE Studio to familiarize myself with its content, certain indicators immediately suggest that it is a DLL and likely a .NET binary.</p><p><img data-src="https://i.imgur.com/3g2y9k6.png" alt="img_2" data-proofer-ignore></p><p>The next step is to check its exported functions.</p><p><img data-src="https://i.imgur.com/WGDcDkY.png" alt="img_2" data-proofer-ignore></p><p>Opening dll in Dnspy</p><p><img data-src="https://i.imgur.com/NYeyhJj.png" alt="img_2" data-proofer-ignore></p><p>After opening the DLL and performing cleanup, we can observe that the initial section gathers information about installed antivirus programs. Specifically, it checks for Avast, Avira, and AVG. If any of these antivirus programs are detected, the DLL proceeds to execute a file. This file contains a Base64 payload that is passed to it by the parent process. The payload is then formatted and written to a file, utilizing “mshta.exe” as a means of evading detection.</p><p>On the other hand, if a different antivirus program is found during the check, the file content is simply used to start a process. However, in this particular case, this part of the program remains unused.</p><p><img data-src="https://i.imgur.com/0TrZbBg.png" alt="img_2" data-proofer-ignore></p><p>This particular segment of the code is actively utilized in this case. It involves the receipt of a URL parameter passed by the parent process. Subsequently, the DLL leverages this URL to fetch a payload, which is then stored in an array. The payload is formatted accordingly and subsequently executed as a separate process.</p><p>In the event that the process creation encounters any issues or fails for some reason, the DLL is designed to handle the exception (reason for the crash). It captures the relevant exception data and sends it back to the original URL in a specific format, making it recognizable and processable on the server side. Additionally, the DLL takes the necessary step to terminate the problematic process.</p><p>Overall, this functionality allows the code to dynamically retrieve and execute payloads from the provided URL while effectively handling errors and reporting them back to the server for further analysis.</p><p><img data-src="https://i.imgur.com/bawTPT8.png" alt="img_2" data-proofer-ignore></p><p>Indeed, it seems that the third stage of the code was promptly removed upon being reported, leading to no success in retrieving it. As a result, access to the content and functionalities of the third stage remains elusive. The removal of the third stage can be seen as a defensive measure taken by the developers to prevent further analysis or detection of their code’s full capabilities.</p><p>In such cases, it becomes challenging to gain a comprehensive understanding of the entire code’s behavior and intended purpose.</p><p>IOC :</p><p>eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7</p><p><b> <a href="https://github.com/Megachar0x01/megachar0x01.github.io/blob/main/tmp/Decoding%20Sidewinder%20APT%3A%20Unveiling%20Its%20Mysterious%20Journey.zip">All The Required Files</a> </b></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/malware/'>Malware</a>, <a href='//categories/win/'>win</a>, <a href='//categories/apt/'>Apt</a>, <a href='//categories/cve-2017-0199/'>CVE-2017-0199</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Decoding+Sidewinder+APT+Malware+-+Megachar0x01&url=https%3A%2F%2Fmegachar0x01.github.io%2Fposts%2Feeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Decoding+Sidewinder+APT+Malware+-+Megachar0x01&u=https%3A%2F%2Fmegachar0x01.github.io%2Fposts%2Feeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmegachar0x01.github.io%2Fposts%2Feeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7%2F&text=Decoding+Sidewinder+APT+Malware+-+Megachar0x01" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/98ec204106d3e4d225d14217d9e16f106f5d8f0e3d1c8c1a3eb4d6184f7316d7/">Cereberus 2024</a><li><a href="/posts/Array/">V8 Internals Part 1</a><li><a href="/posts/unlimited_subway__csaw_quater_2023/">Unlimited Subway csaw quater 2023</a><li><a href="/posts/CallBack/">CallBack</a><li><a href="/posts/eeeb99f94029fd366dcde7da2a75a849833c5f5932d8f1412a89ca15b9e9ebb7/">Decoding Sidewinder APT Malware</a></ul></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/iran-steel/"><div class="card-body"> <em class="small" data-ts="1656518400" data-df="ll" > Jun 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Iran Steel Mill malware</h3><div class="text-muted small"><p> Summary : Chaplin.exe runs which disable all network adapters and look for screen.exe then executes it. Screen.exe will delete the lsa registry key. Start the video and open the registry, which st...</p></div></div></a></div><div class="card"> <a href="/posts/09cc7d0af801e5a3bebaa46a5b61bcc4eb133e2fe5159c65d47073c6a8163d80/"><div class="card-body"> <em class="small" data-ts="1661961600" data-df="ll" > Sep 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Malicious Zip</h3><div class="text-muted small"><p> Purpose : Analyzing The Malware Behaviour Suspicious rar contains 3 files 2 are cleared  and 1 (file).lnk is malicious {Deduce after investigation }. lets start investigation .(58ec917b5d2e14846f...</p></div></div></a></div><div class="card"> <a href="/posts/98ec204106d3e4d225d14217d9e16f106f5d8f0e3d1c8c1a3eb4d6184f7316d7/"><div class="card-body"> <em class="small" data-ts="1710604800" data-df="ll" > Mar 17, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cereberus 2024</h3><div class="text-muted small"><p> First, we begin with basic analysis. This involves checking its hash on VirusTotal and extracting hashes using HashMyFile. Checking on VirusTotal. After obtaining some hits, it’s time to inve...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/Weird_Cookie_nahamcon_2023/" class="btn btn-outline-primary" prompt="Older"><p>Weird Cookie , NahamCon 2023</p></a> <a href="//posts/CallBack/" class="btn btn-outline-primary" prompt="Newer"><p>CallBack</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/megachar0x01">Abdullah Shahbaz</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
